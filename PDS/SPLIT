 MACRO
&NAME SPLIT &T
 COPY SYSGBL
 LCLA &FR,&I,&IN,&IN2,&OK
 LCLB &DEF
 LCLC &XC,&OI(16)
.*  RESTITUITI
.*  &OT TIPO DI OPERANDO    OP OPPURE REG
.*  &OL LUNGHEZZA OPERANDO
.*  &O  OPERANDO PRIVO DI INDICAZIONI DI LUNGHEZZA
&OT SETC 'OP'  DEFAULT OPERANDO (NON REGISTRO)
&OL SETA 4     LUNGHEZZA DI DEFAULT
&OC SETA 1  DIMENSIONE USATA DEL VETTORE ' O '
 AIF ('&NAME'  EQ '').LOOP
&NAME EQU *
.LOOP  ANOP
&FR SETA &FR+1
 AIF (K'&T LT &FR).ENDT
 AIF ('&T'(&FR,1) EQ '(').LP
 AIF ('&T'(&FR,1) EQ ')').RP
 AIF ('&T'(&FR,1) EQ '''').SEGNO
 AIF ('&T'(&FR,1) EQ '+').SEGNO
 AIF ('&T'(&FR,1) EQ '-').SEGNO
 AIF ('&T'(&FR,1) EQ '/').SEGNO
 AIF ('&T'(&FR,1) EQ ',').SEGNO
 AIF ('&T'(&FR,1) EQ '*').SEGNO
 AIF (&I NE 0).OK
&I SETA 1
.OK ANOP
&OI(&I) SETC '&OI(&I)'.'&T'(&FR,1)
 AGO .LOOP
.LP AIF (&I NE 0).SEGNO
&OT SETC 'REG'
 AGO .LOOP
.SEGNO ANOP
&I SETA &I+1
&OI(&I)  SETC '&T'(&FR,1)
&I SETA &I+1
 AGO .LOOP
.RP AIF ('&OT' EQ 'REG').LOOP
 AGO .SEGNO
.ENDT ANOP
&OC SETA &I+2  SIZE ARRAY
 AIF ('&OI(2)'  EQ ',').FIRST
&FR SETA 0   POINTER ARRAY
.LOOP2 ANOP
&FR SETA &FR+1   POINTER
&I SETA &FR+2   POINTER+2
.LOOP21 ANOP
 AIF (&I GT &OC).ENDSC
 AIF ('&OI(&FR)' EQ '(' AND '&OI(&I)' EQ ',').LDETTA
 AIF ('&OI(&FR)' EQ '(' AND '&OI(&I)' EQ ')').LUYN
 AGO .LOOP2
.FIRST ANOP
&OL SETA &OI(1)
&FR SETA 1
&DEF SETB 1
 AGO .LDETTA2
.LDETTA ANOP
&FR SETA &FR+1
&OL SETA &OI(&FR)
.SETB ANOP
&DEF SETB 1
.LDETTA2  ANOP
&I SETA &FR+2
 AIF ('&I' GT '&OC').ENDLO
&OI(&FR) SETC '&OI(&I)'
&FR SETA &FR+1
 AGO .LDETTA2
.ENDLO ANOP
&OC SETA &FR
 AGO .ENDSC
.LUYN AIF ('&T'(1,2) EQ 'X''' ).ENDSC
&XC SETC '&OI(1)'
&XC SETC '&XC'(1,1)
 AIF ('&XC' EQ '0' OR '&XC'  EQ '1' OR '&XC' EQ '2').ENDSC
 AIF ('&XC' EQ '3' OR '&XC'  EQ '4' OR '&XC' EQ '5').ENDSC
 AIF ('&XC' EQ '6' OR '&XC'  EQ '7' OR '&XC' EQ '8').ENDSC
 AIF ('&XC' EQ '9').ENDSC
.LOOP3 ANOP
&OC SETA &FR-1
&OL SETA &OI(&FR+1)
&DEF SETB 1
&OI(&FR) SETC ''
&OI(&FR+1) SETC ''
&OI(&FR+2) SETC ''
 AGO .ENDSC
.ENDSC ANOP
 AIF (&DEF).COMPAKT
 AIF (T'&T EQ 'U').COMPAKT
 AIF (T'&T EQ 'M').COMPAKT
 AIF (T'&T EQ 'N').COMPAKT
&OL SETA L'&T
.COMPAKT ANOP
&O SETC '&OI(1)'.'&OI(2)'.'&OI(3)'.'&OI(4)'.'&OI(5)'.'&OI(6)'.'&OI(7)'.*
               '&OI(8)'.'&OI(9)'.'&OI(10)'.'&OI(11)'.'&OI(12)'.'&OI(13)*
               '.'&OI(14)'.'&OI(15)'.'&OI(16)'
 MEND
